import streamlit as st
import pandas as pd
import numpy as np
import time

# --- 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÅ‡∏£‡∏Å‡∏™‡∏∏‡∏î) ---
st.set_page_config(
    page_title="Team Sensor Command Center",
    page_icon="‚ö°",
    layout="wide",
    initial_sidebar_state="expanded"
)

# ==========================================
# ‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ (Updated) ‚ö†Ô∏è
# ==========================================
# 1. ‡∏•‡∏¥‡∏á‡∏Å‡πå CSV ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• User
SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR0XoahMwduVM49_EJjYxMnbU9ABtSZzYPiInXBvSf_LhtAJqhl_5FRw-YrHQ7EIl2wbN27uZv0YTz9/pub?output=csv"

# 2. ‡∏•‡∏¥‡∏á‡∏Å‡πå Google Form ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSdx0bamRVPVOfiBXMpbbOSZny9Snr4U0VImflmJwm6KcdYKSA/viewform?usp=publish-editor"
# ==========================================

# --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• User ---
def load_users():
    try:
        # ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå CSV ‡∏à‡∏≤‡∏Å Google Sheet
        df = pd.read_csv(SHEET_URL, on_bad_lines='skip')
        
        # ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î
        # ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏° Sheet: Timestamp, User, Pass, Name, Role
        if len(df.columns) >= 5:
            df.columns.values[1] = 'username'
            df.columns.values[2] = 'password'
            df.columns.values[3] = 'name'
            df.columns.values[4] = 'role'
        
        # ‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏î
        df['password'] = df['password'].astype(str)
        # ‡∏ñ‡πâ‡∏≤ Role ‡∏ß‡πà‡∏≤‡∏á ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô User ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤
        df['role'] = df['role'].fillna('User')
        
        return df
    except Exception as e:
        # ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
        return pd.DataFrame()

# --- ‡∏´‡∏ô‡πâ‡∏≤ Login ---
def login_page():
    # ‡∏à‡∏±‡∏î‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á
    c1, c2, c3 = st.columns([1, 1, 1])
    with c2:
        try:
            st.image("logo.png", use_container_width=True)
        except:
            st.header("‚ö° TEAM SENSOR")
            st.caption("Please upload logo.png")

    st.markdown("<h3 style='text-align: center;'>System Login</h3>", unsafe_allow_html=True)

    tab1, tab2 = st.tabs(["üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö", "üìù ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å"])

    with tab1:
        username = st.text_input("Username", key="login_user")
        password = st.text_input("Password", type="password", key="login_pass")
        
        if st.button("Login", use_container_width=True):
            df = load_users()
            
            if not df.empty:
                # ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ User (‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô String ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏ß‡∏£‡πå)
                user_match = df[
                    (df['username'].astype(str) == username) & 
                    (df['password'].astype(str) == password)
                ]
                
                if not user_match.empty:
                    user_data = user_match.iloc[0]
                    st.session_state['logged_in'] = True
                    st.session_state['user'] = user_data['name']
                    # ‡∏ï‡∏±‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤/‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏≠‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
                    st.session_state['role'] = str(user_data['role']).strip() 
                    
                    st.success(f"‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö: {user_data['name']}")
                    time.sleep(1)
                    st.rerun()
                else:
                    st.error("Username ‡∏´‡∏£‡∏∑‡∏≠ Password ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á")
            else:
                st.error("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ (‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤)")

    with tab2:
        st.info("‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ô‡∏≥‡∏ó‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡πà‡∏≤‡∏ô Google Form")
        st.link_button("üëâ ‡∏Å‡∏î‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£", FORM_URL, use_container_width=True)
        st.caption("*‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡πÅ‡∏à‡πâ‡∏á Admin ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≠‡∏á Login ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢")

# --- ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å (Main App) ---
def main_app():
    # Sidebar ‡πÄ‡∏°‡∏ô‡∏π
    with st.sidebar:
        st.write(f"üë§ **{st.session_state['user']}**")
        
        # Badge ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        role = st.session_state['role']
        if role == 'Admin':
            st.success(f"Role: {role}")
        else:
            st.info(f"Role: {role}")
            
        # ‡πÄ‡∏°‡∏ô‡∏π Admin (‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Admin)
        if role == 'Admin':
            st.divider()
            st.error("üîß Admin Zone")
            if st.checkbox("‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å"):
                st.dataframe(load_users())
                st.caption("‡πÑ‡∏õ‡πÅ‡∏Å‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ó‡∏µ‡πà Google Sheet ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö")

        st.divider()
        if st.button("Log out", type="primary"):
            st.session_state['logged_in'] = False
            st.rerun()

    # ================= DASHBOARD CONTENT =================
    
    # ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Quiz
    quiz_data = {
        "Heat Balance": [
            {"q": "‡∏™‡∏π‡∏ï‡∏£‡∏Å‡∏≤‡∏£‡∏´‡∏≤ % Heat Balance ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å Engineering ‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡πÉ‡∏î?", "c": ["(Qevap + Winput - Qcond) / Qcond * 100", "(Qevap - Qcond) / Winput * 100", "(Qcond + Winput) / Qevap * 100", "Qevap / Qcond * 100"], "a": "(Qevap + Winput - Qcond) / Qcond * 100"},
            {"q": "‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (Criteria) ‡∏Ç‡∏≠‡∏á % Heat Balance ‡∏ó‡∏µ‡πà‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?", "c": ["¬± 10%", "¬± 5%", "¬± 2%", "0% ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô"], "a": "¬± 5%"},
            {"q": "‡∏´‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Qevap (Cooling Load) ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÄ‡∏õ‡πá‡∏ô Ton ‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏∑‡∏≠ 500 x GPM x Delta T ‡∏´‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?", "c": ["12,000", "24", "3.516", "15,000"], "a": "12,000"},
            {"q": "‡∏Ñ‡πà‡∏≤ W_input ‡πÉ‡∏ô‡∏™‡∏°‡∏Å‡∏≤‡∏£ Heat Balance ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏ß‡∏ô‡πÑ‡∏´‡∏ô?", "c": ["‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡πÅ‡∏™‡∏á‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå", "‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏Ç‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏µ‡πà Chiller ‡πÉ‡∏ä‡πâ (Compressor work)", "‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏•‡∏°‡∏à‡∏≤‡∏Å Cooling Tower", "‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏®‡∏±‡∏Å‡∏¢‡πå‡∏Ç‡∏≠‡∏á‡∏õ‡∏±‡πä‡∏°‡∏ô‡πâ‡∏≥"], "a": "‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏Ç‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏µ‡πà Chiller ‡πÉ‡∏ä‡πâ (Compressor work)"},
            {"q": "‡∏ñ‡πâ‡∏≤ % Heat Balance ‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô +15% (Positive) ‡∏Ç‡πâ‡∏≠‡πÉ‡∏î‡∏Ñ‡∏∑‡∏≠‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î?", "c": ["‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ß‡∏±‡∏î Flow ‡∏ù‡∏±‡πà‡∏á Evaporator ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏ï‡πà‡∏≥‡πÄ‡∏Å‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á", "‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ß‡∏±‡∏î Flow ‡∏ù‡∏±‡πà‡∏á Condenser ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏ï‡πà‡∏≥‡πÄ‡∏Å‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á", "‡πÑ‡∏ü‡∏ï‡∏Å", "‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡πÅ‡∏≠‡∏£‡πå‡∏£‡∏±‡πà‡∏ß"], "a": "‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ß‡∏±‡∏î Flow ‡∏ù‡∏±‡πà‡∏á Condenser ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏ï‡πà‡∏≥‡πÄ‡∏Å‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á"},
            {"q": "1 Ton ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏¢‡πá‡∏ô (RT) ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏Å‡∏µ‡πà kW (Thermal)?", "c": ["1.0 kW", "3.5169 kW", "12 kW", "0.284 kW"], "a": "3.5169 kW"},
            {"q": "‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô CPN ‡∏™‡∏≤‡∏Ç‡∏≤‡∏®‡∏£‡∏µ‡∏£‡∏≤‡∏ä‡∏≤ ‡∏û‡∏ö‡∏ß‡πà‡∏≤ %Heat Balance ‡∏™‡∏π‡∏á‡∏ñ‡∏∂‡∏á 100.09% ‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡πÉ‡∏î?", "c": ["‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢", "Flowrate ‡∏ù‡∏±‡πà‡∏á Condenser ‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ GUI)", "‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡∏£‡πâ‡∏≠‡∏ô‡∏à‡∏±‡∏î", "‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏¥‡∏î"], "a": "Flowrate ‡∏ù‡∏±‡πà‡∏á Condenser ‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ GUI)"},
            {"q": "Qcond (Heat Rejection) ‡∏õ‡∏Å‡∏ï‡∏¥‡∏à‡∏∞‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ Qevap (Cooling Load)?", "c": ["‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏™‡∏°‡∏≠", "‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô‡πÄ‡∏™‡∏°‡∏≠", "‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏™‡∏°‡∏≠ (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏°‡πÄ‡∏û‡∏£‡∏™‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏î‡πâ‡∏ß‡∏¢)", "‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà‡∏£‡∏∏‡πà‡∏ô Chiller"], "a": "‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏™‡∏°‡∏≠ (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏°‡πÄ‡∏û‡∏£‡∏™‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏î‡πâ‡∏ß‡∏¢)"},
            {"q": "‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢ GPM ‡πÄ‡∏õ‡πá‡∏ô Ton ‡πÉ‡∏ô‡∏™‡∏π‡∏ï‡∏£ Ton = (GPM x Delta T) / 24 ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö GPM ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÉ‡∏î?", "c": ["Imperial Gallon (UK)", "US Gallon", "Liters per minute", "Cubic meter per hour"], "a": "US Gallon"},
            {"q": "‡∏ó‡∏≥‡πÑ‡∏°‡πÄ‡∏£‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Heat Balance?", "c": ["‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡πÑ‡∏ü", "‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î (Data Integrity)", "‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ô‡πâ‡∏≥", "‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏â‡∏¢‡πÜ"], "a": "‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î (Data Integrity)"}
        ],
        "Calibration": [
            {"q": "‡∏™‡∏°‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏Ñ‡πà‡∏≤ Error ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå ‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡πÉ‡∏î?", "c": ["Error = Standard - Reading", "Error = Reading (UUC) - Standard", "Error = Standard / Reading", "Error = (Standard + Reading) / 2"], "a": "Error = Reading (UUC) - Standard"},
            {"q": "DUT ‡∏¢‡πà‡∏≠‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏≠‡∏∞‡πÑ‡∏£?", "c": ["Device Under Test", "Data Unit Transfer", "Digital Utility Tool", "Daily Usage Time"], "a": "Device Under Test"},
            {"q": "‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå Reference Standard ‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡∏°‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö Temp/Humidity ‡∏Ñ‡∏∑‡∏≠‡∏£‡∏∏‡πà‡∏ô‡πÉ‡∏î?", "c": ["Fluke 87V", "Testo 440dp", "Hioki PW3360", "Kyoritsu 4105"], "a": "Testo 440dp"},
            {"q": "‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö (Calibration) ‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡πâ‡∏á (Adjustment) ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?", "c": ["‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô", "Calibration ‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π Error, Adjustment ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÑ‡∏Ç‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á", "Calibration ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°", "Adjustment ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ñ‡πà‡∏≤‡∏ô"], "a": "Calibration ‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π Error, Adjustment ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÑ‡∏Ç‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á"},
            {"q": "‡∏ñ‡πâ‡∏≤ Standard ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ 25.0¬∞C ‡πÅ‡∏ï‡πà Sensor ‡πÄ‡∏£‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ 25.5¬∞C ‡∏Ñ‡πà‡∏≤ Error ‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?", "c": ["-0.5¬∞C", "+0.5¬∞C", "0.0¬∞C", "1.02%"], "a": "+0.5¬∞C"},
            {"q": "Uncertainty ‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡∏≠‡∏∞‡πÑ‡∏£?", "c": ["‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î", "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡∏ß‡∏±‡∏î", "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Å‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠", "‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ó‡∏ò‡πå"], "a": "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î"},
            {"q": "‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÅ‡∏ö‡∏ö Comparison ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", "c": ["‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (Standard) ‡πÉ‡∏ô‡∏™‡∏†‡∏≤‡∏ß‡∏∞‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô", "‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏õ‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®", "‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏≠‡∏≤‡πÄ‡∏≠‡∏á", "‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß"], "a": "‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (Standard) ‡πÉ‡∏ô‡∏™‡∏†‡∏≤‡∏ß‡∏∞‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô"},
            {"q": "‡∏à‡∏≤‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ Zigbee Sensor ‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ó‡∏µ‡πà‡∏à‡∏∏‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô (Humidity) ‡∏Å‡∏µ‡πà‡∏à‡∏∏‡∏î?", "c": ["1 ‡∏à‡∏∏‡∏î (50%)", "3 ‡∏à‡∏∏‡∏î (50%, 70%, 90%)", "5 ‡∏à‡∏∏‡∏î", "‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô"], "a": "3 ‡∏à‡∏∏‡∏î (50%, 70%, 90%)"},
            {"q": "‡∏ñ‡πâ‡∏≤‡∏Ñ‡πà‡∏≤ Error ‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î (Out of Tolerance) ‡πÄ‡∏£‡∏≤‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?", "c": ["‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ", "‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Adjustment ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Sensor ‡πÉ‡∏´‡∏°‡πà", "‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏¥‡πâ‡∏á", "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô"], "a": "‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Adjustment ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Sensor ‡πÉ‡∏´‡∏°‡πà"},
            {"q": "Testo 440dp ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô Standard ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö (Re-calibration) ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?", "c": ["‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏û‡∏á", "‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ï‡∏≤‡∏°‡∏£‡∏≠‡∏ö (‡πÄ‡∏ä‡πà‡∏ô ‡∏ó‡∏∏‡∏Å 1 ‡∏õ‡∏µ)", "‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ï‡∏•‡∏≠‡∏î‡∏ä‡∏µ‡∏û", "‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå"], "a": "‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ï‡∏≤‡∏°‡∏£‡∏≠‡∏ö (‡πÄ‡∏ä‡πà‡∏ô ‡∏ó‡∏∏‡∏Å 1 ‡∏õ‡∏µ)"}
        ],
        "CPMS & Efficiency": [
            {"q": "‡∏Ñ‡πà‡∏≤ Efficiency ‡∏Ç‡∏≠‡∏á Chiller (kW/RT) ‡∏¢‡∏¥‡πà‡∏á‡∏°‡∏≤‡∏Å ‡∏´‡∏£‡∏∑‡∏≠ ‡∏¢‡∏¥‡πà‡∏á‡∏ô‡πâ‡∏≠‡∏¢ ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏î‡∏µ?", "c": ["‡∏¢‡∏¥‡πà‡∏á‡∏°‡∏≤‡∏Å‡∏¢‡∏¥‡πà‡∏á‡∏î‡∏µ", "‡∏¢‡∏¥‡πà‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏¢‡∏¥‡πà‡∏á‡∏î‡∏µ", "‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö 1.0 ‡πÄ‡∏™‡∏°‡∏≠", "‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô"], "a": "‡∏¢‡∏¥‡πà‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏¢‡∏¥‡πà‡∏á‡∏î‡∏µ"},
            {"q": "Approach Temp ‡∏Ç‡∏≠‡∏á Evaporator ‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÉ‡∏î?", "c": ["Leaving Chilled Water Temp ‡∏Å‡∏±‡∏ö Refrigerant Temp", "Entering Condenser Water ‡∏Å‡∏±‡∏ö Wet Bulb", "Chilled Water Supply ‡∏Å‡∏±‡∏ö Return", "‡∏ô‡πâ‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ ‡∏Å‡∏±‡∏ö ‡∏ô‡πâ‡∏≥‡∏≠‡∏≠‡∏Å"], "a": "Leaving Chilled Water Temp ‡∏Å‡∏±‡∏ö Refrigerant Temp"},
            {"q": "‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô CPN ‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤ ‡∏Ñ‡πà‡∏≤ Chiller Plant Efficiency ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?", "c": ["0.65 kW/RT", "0.76 kW/RT", "1.20 kW/RT", "0.50 kW/RT"], "a": "0.76 kW/RT"},
            {"q": "‡∏ñ‡πâ‡∏≤ Approach Temp ‡∏Ç‡∏≠‡∏á Condenser ‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ (‡πÄ‡∏ä‡πà‡∏ô > 3¬∞F) ‡∏ö‡πà‡∏á‡∏ö‡∏≠‡∏Å‡∏ñ‡∏∂‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏∞‡πÑ‡∏£?", "c": ["‡∏ó‡πà‡∏≠ Condenser ‡∏™‡∏Å‡∏õ‡∏£‡∏Å (Fouling) ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏∞‡∏Å‡∏£‡∏±‡∏ô‡∏à‡∏±‡∏ö", "‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡πÅ‡∏≠‡∏£‡πå‡∏Ç‡∏≤‡∏î", "‡∏Ñ‡∏≠‡∏°‡πÄ‡∏û‡∏£‡∏™‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏û‡∏±‡∏á", "‡∏û‡∏±‡∏î‡∏•‡∏° Cooling Tower ‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ"], "a": "‡∏ó‡πà‡∏≠ Condenser ‡∏™‡∏Å‡∏õ‡∏£‡∏Å (Fouling) ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏∞‡∏Å‡∏£‡∏±‡∏ô‡∏à‡∏±‡∏ö"},
            {"q": "kW/RT ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏™‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏î?", "c": ["Power (kW) / Cooling Load (Ton)", "Cooling Load (Ton) / Power (kW)", "Flow (GPM) x Delta T", "Volt x Amp x PF"], "a": "Power (kW) / Cooling Load (Ton)"},
            {"q": "Chiller ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (kW/RT ‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î) ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà Load ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?", "c": ["10-20%", "40-50%", "70-90%", "100% ‡πÄ‡∏ï‡πá‡∏°‡∏û‡∏¥‡∏Å‡∏±‡∏î"], "a": "70-90%"},
            {"q": "‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ (‡∏ö‡∏≤‡∏ó) ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢ ‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡πÉ‡∏î?", "c": ["kW x ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô x ‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢", "Ton x ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á x 10", "Amp x Volt", "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏ñ‡∏π‡∏Å"], "a": "kW x ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô x ‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢"},
            {"q": "Delta T (‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ô‡πâ‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å) ‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Chiller ‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?", "c": ["2¬∞F", "5¬∞F", "10¬∞F", "20¬∞F"], "a": "10¬∞F"},
            {"q": "‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ VSD (Variable Speed Drive) ‡∏Å‡∏±‡∏ö‡∏õ‡∏±‡πä‡∏°‡∏ô‡πâ‡∏≥‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∞‡πÑ‡∏£?", "c": ["‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ô‡πâ‡∏≥", "‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠ Load ‡∏•‡∏î‡∏•‡∏á", "‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ô‡πâ‡∏≥‡πÄ‡∏¢‡πá‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô", "‡∏•‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏£‡∏ö‡∏Å‡∏ß‡∏ô"], "a": "‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠ Load ‡∏•‡∏î‡∏•‡∏á"},
            {"q": "Low Delta T Syndrome (‡πÄ‡∏ä‡πà‡∏ô Delta T ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà 3-4¬∞F) ‡∏™‡πà‡∏á‡∏ú‡∏•‡πÄ‡∏™‡∏µ‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?", "c": ["‡∏õ‡∏±‡πä‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á Flow ‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô", "Chiller ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡πÑ‡∏ü‡∏Ç‡∏∂‡πâ‡∏ô", "‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ô‡πâ‡∏≥‡πÄ‡∏¢‡πá‡∏ô‡∏à‡∏±‡∏î", "‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏ú‡∏•‡πÄ‡∏™‡∏µ‡∏¢"], "a": "‡∏õ‡∏±‡πä‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á Flow ‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô"}
        ]
    }

    # Navigation
    st.sidebar.title("üöÄ Navigation")
    page = st.sidebar.radio("Go to", ["Dashboard ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°", "Learning Academy (‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)", "Quiz ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ"])

    # === PAGE 1: DASHBOARD ===
    if page == "Dashboard ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°":
        st.title("üåè Real-time Command Center")
        
        # Mockup Data (‡πÉ‡∏ä‡πâ pd.DataFrame ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Site)
        if 'sites' not in st.session_state:
            st.session_state.sites = pd.DataFrame({
                'Site Name': ['RBS Chonburi', 'Central Ayutthaya', 'RBS Rayong', 'Robinson Saraburi'],
                'Lat': [13.3611, 14.3532, 12.6828, 14.5290],
                'Lon': [100.9847, 100.5700, 101.2816, 100.9130],
                'Status': ['Normal', 'Critical', 'Maintenance', 'Normal'],
            })

        col1, col2, col3, col4 = st.columns(4)
        col1.metric("Total Sites", len(st.session_state.sites))
        col2.metric("Critical Status", len(st.session_state.sites[st.session_state.sites['Status']=='Critical']), delta="-1")
        col3.metric("Sensors Online", "98.2%", "stable")
        col4.metric("Pending PM", "2 Jobs", "Urgent")

        col_map, col_data = st.columns([1, 1])
        with col_map:
            st.subheader("üìç Site Map")
            map_df = st.session_state.sites.copy()
            map_df['color'] = map_df['Status'].apply(lambda x: '#00FF00' if x=='Normal' else '#FF0000')
            st.map(map_df, latitude='Lat', longitude='Lon', size=20, color='color')

        with col_data:
            st.subheader("üìù Site Data (Editable)")
            edited_df = st.data_editor(st.session_state.sites, num_rows="dynamic")
            if st.button("Save Changes"):
                st.session_state.sites = edited_df
                st.success("Saved!")

    # === PAGE 2: LEARNING ACADEMY ===
    elif page == "Learning Academy (‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)":
        st.title("üìö Team Sensor Academy")
        st.markdown("‡πÅ‡∏´‡∏•‡πà‡∏á‡∏£‡∏ß‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ Engineering ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á")
        
        tab1, tab2, tab3, tab4, tab5 = st.tabs([
            "1. Heat Balance Analysis", 
            "2. Efficiency (kW/RT)", 
            "3. Sensor Calibration",
            "4. ‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ CQ1-CQ7",        
            "5. ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô (Audit)"   
        ])
        
        with tab1:
            st.header("üî• ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå Heat Balance")
            st.info("Heat Balance ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏Ç‡∏≠‡∏á‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô")
            st.latex(r"\% Heat Balance = \frac{(Q_{evap} + W_{input}) - Q_{cond}}{Q_{cond}} \times 100")
            st.markdown("""
            **‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö:** ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô **¬±5%**
            * **‡∏Ñ‡πà‡∏≤‡∏ö‡∏ß‡∏Å (+) ‡∏°‡∏≤‡∏Å:** Flow ‡∏ù‡∏±‡πà‡∏á Condenser ‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏£‡∏¥‡∏á
            * **‡∏Ñ‡πà‡∏≤‡∏•‡∏ö (-) ‡∏°‡∏≤‡∏Å:** Flow ‡∏ù‡∏±‡πà‡∏á Evaporator ‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏£‡∏¥‡∏á ‡∏´‡∏£‡∏∑‡∏≠ Sensor ‡πÄ‡∏û‡∏µ‡πâ‡∏¢‡∏ô
            """)
            
        with tab2:
            st.header("‚ö° ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û (Efficiency)")
            st.markdown("""
            **‡∏™‡∏π‡∏ï‡∏£‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:** $kW/RT = Power / Cooling Load$
            * **‡∏¢‡∏¥‡πà‡∏á‡∏ô‡πâ‡∏≠‡∏¢ ‡∏¢‡∏¥‡πà‡∏á‡∏î‡∏µ** (‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô Chiller ‡πÉ‡∏´‡∏°‡πà ~0.55-0.65 kW/RT)
            * **Approach Temp:** ‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á LWT ‡∏Å‡∏±‡∏ö Refrigerant Temp (‡∏Ñ‡∏ß‡∏£ < 3¬∞F)
            """)

        with tab3:
            st.header("üõ†Ô∏è ‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö (Calibration)")
            st.markdown("""
            **Formula:** $Error = Reading (DUT) - Standard (Ref)$
            * **DUT:** Device Under Test
            * **Ref:** Testo 440dp (Standard ‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏°)
            """)

        with tab4:
            st.header("‡πÑ‡∏Ç‡∏£‡∏´‡∏±‡∏™‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ CQ (Commissioning Questionnaire)")
            cq_data = [
                {"Code": "CQ1", "Name": "Inlet Condensing Temp", "Detail": "‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ô‡πâ‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Condenser (‡∏ó‡πà‡∏≠ Main CDS)"},
                {"Code": "CQ2", "Name": "Inlet Evaporator Temp", "Detail": "‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ô‡πâ‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Evaporator (‡∏ó‡πà‡∏≠ Main CHR)"},
                {"Code": "CQ3", "Name": "Outlet Condensing Temp", "Detail": "‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ô‡πâ‡∏≥‡∏≠‡∏≠‡∏Å Condenser"},
                {"Code": "CQ4", "Name": "Outlet Evaporator Temp", "Detail": "‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ô‡πâ‡∏≥‡∏≠‡∏≠‡∏Å Evaporator"},
                {"Code": "CQ5", "Name": "Diff Pressure (CDP)", "Detail": "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏±‡πä‡∏° Condenser"},
                {"Code": "CQ6", "Name": "Diff Pressure (CHP)", "Detail": "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏±‡πä‡∏° Chiller"},
                {"Code": "CQ7", "Name": "Building Load (kW)", "Detail": "‡∏†‡∏≤‡∏£‡∏∞‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£"}
            ]
            st.table(pd.DataFrame(cq_data))

        with tab5:
            st.header("üìã ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô (Audit)")
            c1, c2 = st.columns(2)
            with c1:
                st.subheader("1. ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û")
                st.markdown("* Chiller (Ton, Qty)\n* Pump Motor (kW)\n* Cooling Tower Fan (kW)\n* Operation Schedule")
            with c2:
                st.subheader("2. ‡∏à‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ (HMI)")
                st.markdown("* Power (kW, V, A)\n* Setpoint\n* Evap/Cond Temp\n* Refrigerant Temp")

    # === PAGE 3: QUIZ ===
    elif page == "Quiz ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ":
        st.title("‚úçÔ∏è ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ (Quiz)")
        
        topic = st.selectbox("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏™‡∏≠‡∏ö:", list(quiz_data.keys()))
        
        if "current_quiz" not in st.session_state or st.session_state.quiz_topic != topic:
            st.session_state.quiz_topic = topic
            st.session_state.current_quiz = quiz_data[topic]
            st.session_state.score = 0
            st.session_state.submitted = False

        with st.form("quiz_form"):
            user_answers = {}
            for i, q_item in enumerate(st.session_state.current_quiz):
                st.markdown(f"**‡∏Ç‡πâ‡∏≠ {i+1}: {q_item['q']}**")
                user_answers[i] = st.radio(f"‡∏Ç‡πâ‡∏≠ {i+1}", q_item['c'], key=f"q_{topic}_{i}", index=None, label_visibility="collapsed")
                st.markdown("---")
            
            if st.form_submit_button("‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö"):
                score = 0
                st.session_state.submitted = True
                st.header("üìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö")
                for i, q_item in enumerate(st.session_state.current_quiz):
                    if user_answers.get(i) == q_item['a']:
                        score += 1
                        st.success(f"‡∏Ç‡πâ‡∏≠ {i+1}: ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‚úÖ")
                    else:
                        st.error(f"‡∏Ç‡πâ‡∏≠ {i+1}: ‡∏ú‡∏¥‡∏î ‚ùå (‡∏ï‡∏≠‡∏ö: {q_item['a']})")
                
                st.metric("‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì", f"{score} / 10")
                if score >= 8:
                    st.balloons()
                    st.success("‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î! ‡∏Ñ‡∏∏‡∏ì‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç üéâ")

# --- ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å (Main Execution) ---
if 'logged_in' not in st.session_state:
    st.session_state['logged_in'] = False

if not st.session_state['logged_in']:
    login_page()
else:
    main_app()